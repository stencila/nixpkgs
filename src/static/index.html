<!doctype html>
<html>
  <head>
    <title>Nixter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.1.1/es6-promise.auto.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.min.js"></script>
    <script src="https://unpkg.com/xterm@3.10.1/dist/xterm.js"></script>
    <script src="https://unpkg.com/xterm@3.10.1/dist/addons/fit/fit.js"></script>
    <script src="https://unpkg.com/xterm@3.10.1/dist/addons/attach/attach.js"></script>
    <script src="https://unpkg.com/xterm@3.10.1/dist/addons/winptyCompat/winptyCompat.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/xterm@3.10.1/dist/xterm.css" />
    <link rel="stylesheet" href="https://unpkg.com/xterm@3.10.1/dist/addons/fullscreen/fullscreen.css" />
  </head>
  <body>
    <div id="terminal" style="position:absolute; width:100%; height:100%; padding: 0.5em; background: black">
    </div>
    <script>
      // Apply addons
      Terminal.applyAddon(attach);
      Terminal.applyAddon(fit);
      Terminal.applyAddon(winptyCompat);
      
      // Create terminal
      const term = new Terminal();
      term.winptyCompatInit();
      const container = document.getElementById('terminal');
      term.open(container);
      term.fit();

      // Connect to server
      const protocol = (location.protocol === 'https:') ? 'wss://' : 'ws://';
      const port = location.port ? `:${location.port}` : '';
      const socket = new WebSocket(`${protocol}${location.hostname}${port}/shell`);
      socket.onopen = (ev) => { term.attach(socket); };
    </script>
  </body>
</html>
